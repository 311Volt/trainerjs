(()=>{function c(r){return document.getElementById(r)}function a(r,e){return r.getElementsByClassName(e)[0]}function S(r,e){return String.fromCharCode(r.charCodeAt(0)+e)}function y(r){let e=new Array(r);for(var t=0;t<r;t++)e[t]=t;return e}function k(r,e,t){return Math.max(e,Math.min(r,t))}function w(r){let e=y(r);for(var t=r-1;t>=1;t--){let s=Math.floor(Math.random()*t),n=e[s];e[s]=e[t],e[t]=n}return e}function q(r){let e=r.length,t=new Array(e);for(var s=0;s<e;s++)t[r[s]]=s;return t}function C(r,e){return new Set([...r].filter(t=>e.has(t)))}function N(r,e){return new Set([...r].filter(t=>!e.has(t)))}function o(r,e){let t=document.createElement(r);return t.innerText=e,t}function E(r){let e=o("a",r);return e.href=r,e}function P(r){for(var e=0,t=0,s=0;s<r.length;s++)if(isNaN(r[s])){switch(r[s]){case"h":t*=3600;break;case"m":t*=60;break;case"s":t*=1;break;default:console.error("unexpected character "+r[s]+" in timestamp")}e+=t,t=0}else t*=10,t+=parseInt(r[s]);return e}var l=class{constructor(e,t){this.qData=t,this.content=t.question,this.containerElement=e,this.evaluateCallback=()=>{}}show(e){}render(){this.eQText.innerText=this.qData.question}evaluate(){this.evaluateCallback()}hide(){this.containerElement.innerHTML=""}getScore(){return 0}};var f=class{constructor(e){this.containerElement=e}static createAnswerElement(e,t,s,n){let i=document.createElement("div");return i.classList.add("trc-ceq-answer","trc-hover-highlight"),i.appendChild(o("strong",S("a",e)+") ")),i.appendChild(o("span",s)),i.setAttribute("data-pos",e),i.setAttribute("data-num",t),i.onclick=n,i}renderAnswers(e,t,s){this.containerElement.innerHTML="";let n=e.length;for(let i=0;i<n;i++)this.containerElement.appendChild(f.createAnswerElement(i,t[i],e[t[i]],()=>{s(i)}));this.answerElements=Array.from(this.containerElement.getElementsByClassName("trc-ceq-answer"))}updateAnswerSelections(e,t){this.answerElements.forEach(s=>{let n=s.getAttribute("data-num");e.has(String(n))?s.classList.add("trc-selected-answer"):s.classList.remove("trc-selected-answer")})}revealCorrectAnswers(e){this.answerElements.forEach(t=>{t.classList.remove("trc-hover-highlight"),t.onclick=()=>{},e.has(t.getAttribute("data-num"))?t.classList.add("trc-correct-answer"):t.classList.add("trc-wrong-answer")})}},u=class extends l{constructor(e,t){super(e,t);this.selectedAnswers=new Set,this.view=new f(this.containerElement),this.ansPermutation=w(this.getNumAnswers()),this.ansInvPermutation=q(this.ansPermutation),this.buildCorrectAnswerSet()}buildCorrectAnswerSet(){this.correctAnswers=new Set,this.correctAnswers.add(String(this.qData.correctAnswer))}getNumAnswers(){return this.qData.answers.length}show(){this.render()}getAnswerAtPos(e){return this.qData.answers[this.ansPermutation[e]]}render(){this.view.renderAnswers(this.qData.answers,this.ansPermutation,e=>{this.selectAnswer(e)})}selectAnswer(e){this.selectedAnswers.add(String(this.ansPermutation[e])),this.view.updateAnswerSelections(this.selectedAnswers,this.ansInvPermutation),this.evaluate()}getScore(){if(this.correctAnswers.size==0)return this.selectedAnswers.size==0?1:0;let e=N(new Set(y(this.getNumAnswers()).map(d=>String(d))),this.correctAnswers),t=C(this.correctAnswers,this.selectedAnswers),s=C(e,this.selectedAnswers),n=t.size-s.size;return k(n/this.correctAnswers.size,0,1)}evaluate(){return this.view.revealCorrectAnswers(this.correctAnswers),this.evaluateCallback(),this.getScore()}};var g=class extends u{constructor(e,t){super(e,t)}buildCorrectAnswerSet(){this.correctAnswers=new Set(this.qData.correctAnswers.map(e=>String(e)))}show(){this.render()}selectAnswer(e){let t=String(this.ansPermutation[e]);this.selectedAnswers.has(t)?this.selectedAnswers.delete(t):this.selectedAnswers.add(t),this.view.updateAnswerSelections(this.selectedAnswers,this.ansInvPermutation)}};var x=class{constructor(e){this.containerElement=e}static createTextArea(){let e=document.createElement("textarea");return e.style.width="500px",e.style.height="200px",e}showTextArea(){this.eTextArea=x.createTextArea(),this.containerElement.appendChild(this.eTextArea)}getAnswer(){return this.eTextArea.value.trim()}},T=class extends l{constructor(e,t){super(e,t);this.view=new x(e)}show(){this.view.showTextArea()}getScore(){return this.view.getAnswer()==this.qData.exampleAnswer.trim()?1:0}evaluate(){return this.evaluateCallback(),this.getScore()}};function z(r){return!(r.includes(`
`)||r.length>=50)}var v=class{constructor(e){this.containerElement=e}static createSubQuestion(e){let t=document.createElement("div");t.appendChild(o("span",e.question));let s=document.createElement("textarea");return s.cols="60",t.appendChild(document.createElement("br")),z(e.exampleAnswer)?(s.cols="30",s.rows="1"):s.rows="15",t.appendChild(s),t}showSubQuestions(){let e=document.createElement("table")}addSubQuestion(e){this.containerElement.appendChild(v.createSubQuestion(e))}getAnswer(e){return this.containerElement.getElementsByTagName("textarea")[e].value.trim()}static createTextArea(){let e=document.createElement("textarea");return e.style.width="500px",e.style.height="200px",e}showTextArea(){this.containerElement.appendChild(TrainerOEQView.createTextArea())}},A=class extends l{constructor(e,t){super(e,t);this.view=new v(e)}show(){this.qData.subQuestions.forEach(e=>{console.log(e),this.view.addSubQuestion(e)})}getScore(){let e=0;for(let t=0;t<this.qData.subQuestions.length;t++)e+=this.qData.subQuestions[t].exampleAnswer.trim()==this.view.getAnswer(t)?1:0;return e/=this.qData.subQuestions.length,e}evaluate(){return this.evaluateCallback(),this.getScore()}};function L(r,e){if(e.questionType=="closed-ended")return new u(r,e);if(e.questionType=="closed-ended-multi")return new g(r,e);if(e.questionType=="open-ended")return new T(r,e);if(e.questionType=="open-ended-multi")return new A(r,e);throw new Error('unrecognized question type: "'+e.questionType+'"')}var m=class{constructor(e){this.containerElement=e}static createAnswerElement(e){let t=document.createElement("div");return t.classList.add("trc-ceq-answer"),t.innerText=e,t}hide(){this.containerElement.style.display="none"}show(e){console.log(e),this.containerElement.innerHTML="",this.containerElement.style.display="block";let t=e.questionType.includes("open")?"Przyk\u0142adowe odpowiedzi":"Poprawne odpowiedzi",s=new Array;e.correctAnswer?s.push(e.answers[e.correctAnswer]):e.correctAnswers?e.correctAnswers.forEach(n=>{s.push(e.answers[n])}):e.exampleAnswer?s.push(e.exampleAnswer):e.subQuestions&&e.subQuestions.forEach(n=>{s.push(n.question+": "+n.exampleAnswer)}),this.containerElement.appendChild(o("h2",t)),s.forEach(n=>{this.containerElement.appendChild(m.createAnswerElement(n))})}};var I=class{constructor(e){this.containerElement=e,this.eCButtons=c("tr-rb-buttons"),this.eCContent=a(this.containerElement,"trc-rb-container")}clearContent(){this.eCContent.innerHTML=""}show(){this.containerElement.style.display="block"}hide(){this.containerElement.style.display="none"}init(){this.show()}updateTabButtons(e){let t=this.eCButtons.getElementsByClassName("trc-tab-button");for(let s=0;s<t.length;s++)e==s?t[s].classList.add("trc-tab-button-active"):t[s].classList.remove("trc-tab-button-active")}setButtonCallbacks(e){Array.from(this.containerElement.getElementsByClassName("trc-tab-button")).forEach(t=>{t.onclick=()=>{e(t.getAttribute("data-tab-id"))}})}showSummary(e,t){let s=document.createElement("div");s.appendChild(o("strong","Pytanie z zakresu: ")),s.appendChild(o("span",e.resource));let n=document.createElement("div");n.appendChild(o("strong","Link do PDF: ")),n.appendChild(E(t.pdf));let i=document.createElement("div");i.appendChild(o("strong","Numery slajd\xF3w: "));let d="";for(let p=0;p<e.pdfPages.length;p++)d+=e.pdfPages[p]+(p==e.pdfPages.length-1?"":", ");i.appendChild(o("span",d));let b=document.createElement("div"),M="https://youtube.com/watch?v="+t.youtube+"?t="+e.ytTimestamps[0];b.appendChild(o("strong","Link do YT: ")),b.appendChild(E(M)),this.eCContent.appendChild(s),this.eCContent.appendChild(n),this.eCContent.appendChild(i),this.eCContent.appendChild(b)}showPresentation(e,t){let s=document.createElement("iframe");s.style.width="100%",s.style.height="600px",s.src=t.pdf+"#page="+e.pdfPages[0],this.eCContent.appendChild(s)}showVideo(e,t){let s=document.createElement("iframe");s.style.width="100%",s.style.height="480px";let n="https://youtube.com/embed/"+t.youtube+"?start"+P(e.ytTimestamps[0])+"&autoplay=1";s.src=n,this.eCContent.appendChild(s)}},Q=class{constructor(e){this.containerElement=e,this.selectedTab=0,this.view=new I(e),this.currTopic=void 0,this.currResource=void 0}init(e,t){this.relevantResources=e,this.resources=t,this.view.init(),this.view.setButtonCallbacks(s=>{this.selectTab(s)})}show(){this.view.show(),this.selectTopic(0),this.selectTab(0)}selectTopic(e){this.currTopic=this.relevantResources[Object.keys(this.relevantResources)[e]],this.currResource=this.resources[this.currTopic.resource]}selectTab(e){switch(this.selectedTab=e,this.view.clearContent(),this.view.updateTabButtons(e),String(e)){case"0":this.view.showSummary(this.currTopic,this.currResource);break;case"1":this.view.showPresentation(this.currTopic,this.currResource);break;case"2":this.view.showVideo(this.currTopic,this.currResource);break;default:throw new Error("tab #"+e+" does not exist")}}};var R=class{constructor(e){this.containerElement=e,this.eQC=a(this.containerElement,"trc-question-container"),this.eQNumberText=a(this.containerElement,"trc-question-number"),this.eQContent=a(this.containerElement,"trc-question-text"),this.eNavButtons=a(this.containerElement,"trc-navigation-buttons"),this.eBtnEvaluate=a(this.eNavButtons,"trc-button-evaluate"),this.eBtnNextQ=a(this.eNavButtons,"trc-button-next-question"),this.eBtnRestart=a(this.eNavButtons,"trc-button-restart")}setButtonCallbacks(e,t,s){this.eBtnEvaluate.onclick=e,this.eBtnNextQ.onclick=t,this.eBtnRestart.onclick=s}resetButtonVisibility(e){this.eBtnEvaluate.classList.remove("trc-btn-inactive"),this.eBtnNextQ.classList.remove("trc-btn-inactive"),this.eBtnNextQ.style.display="none",e.qData.questionType=="closed-ended"?this.eBtnEvaluate.style.display="none":this.eBtnEvaluate.style.display="inline-block",this.eBtnRestart.style.display="none"}showNextQuestionButton(){this.eBtnNextQ.style.display="inline-block",this.eBtnEvaluate.onclick=()=>{},this.eBtnEvaluate.classList.add("trc-btn-inactive")}displayQuestionTitle(e,t,s){this.eQNumberText.innerText="Pytanie "+(e+1)+"/"+t,s&&(this.eQContent.innerText=s.qData.question)}showSummary(e,t){let s=100*e/t;this.eQNumberText.innerText="Test uko\u0144czony",this.eQContent.innerText="Wynik: "+e.toPrecision(3)+" / "+t+" ("+s.toPrecision(3)+"%)",this.eBtnEvaluate.style.display="none",this.eBtnNextQ.style.display="none",this.eBtnRestart.style.display="inline-block"}},B=class{constructor(e,t,s){this.containerElement=e,this.view=new R(this.containerElement),this.ansViewer=new m(c("tr-current-answer")),this.resBrowser=new Q(c("tr-resource-browser")),this.resources=t,this.questionsData=s,this.score=0,this.questions=this.questionsData.map(n=>L(this.view.eQC,n))}getMaxScore(){let e=0;return this.questions.forEach(t=>{t.qData.evaluable||e++}),e}init(){this.questionPermutation=w(this.questions.length),this.currentQuestionIndex=0,this.showQuestion(0)}getNumQuestions(){return this.questions.length}getQuestionAt(e){return this.questions[e]}getCurrentQuestion(){return this.getQuestionAt(this.currentQuestionIndex)}showNextQuestion(){this.getCurrentQuestion().hide(),this.currentQuestionIndex<this.getNumQuestions()-1?this.showQuestion(++this.currentQuestionIndex):this.view.showSummary(this.score,this.getMaxScore())}showQuestion(e){let t=this.getQuestionAt(e);this.ansViewer.hide(),this.resBrowser.view.hide(),this.view.resetButtonVisibility(t),this.view.displayQuestionTitle(e,this.getNumQuestions(),t),this.view.setButtonCallbacks(()=>{t.evaluate()},()=>{this.showNextQuestion()},()=>{this.init()}),t&&(t.evaluateCallback=()=>{this.view.showNextQuestionButton(),this.ansViewer.show(t.qData),this.score+=t.getScore(),this.resBrowser.init(t.qData.relevantResources,this.resources),this.resBrowser.show()},t.show())}start(){}end(){}};var W=void 0;window.onload=function(){Promise.all([fetch("data/resources.json"),fetch("data/questions.json")]).then(r=>{Promise.all([r[0].json(),r[1].json()]).then(e=>{W=new B(c("tr-current-question"),e[0],e[1]),W.init()})}).catch(r=>{console.error(r.message)})};})();
